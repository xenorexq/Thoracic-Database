# 快速开始指南 - v3.6.0 多线程导出功能

## 🎯 新功能速览

v3.6.0 版本为导出功能添加了**多线程并行处理**，让大数据量导出速度提升 **2-4倍**！

## 🚀 立即体验

### 1. 更新到最新版本

```bash
# 下载最新代码
git pull

# 或者下载 ZIP 文件并解压
```

### 2. 确保依赖已安装

```bash
pip install -r requirements.txt
```

依赖包括：
- `openpyxl>=3.0` - Excel 文件处理
- `ttkbootstrap>=1.10.0` - 现代化 UI 主题

### 3. 运行程序

```bash
python main.py
```

## 📊 导出功能使用

### 方式一：图形界面（推荐）

1. **打开程序**，切换到"查询/导出"标签页
2. **选择导出类型**：
   - 导出当前患者 (Excel) - 快速导出单个患者
   - 导出当前患者 (CSV) - CSV 格式单个患者
   - 导出全库 (Excel) - 导出所有数据到一个文件
   - 导出全库 (CSV) - 导出所有数据到多个文件
3. **选择保存位置**
4. **观察进度**：
   - 自动弹出进度窗口
   - 显示实时进度百分比
   - 后台处理，界面不卡顿
5. **完成**：看到成功提示即可

### 方式二：命令行/脚本

```python
from pathlib import Path
from db.models import Database
from export.excel import export_all_to_excel

# 打开数据库
db = Database(Path("thoracic.db"))

# 定义进度回调（可选）
def show_progress(value):
    print(f"导出进度: {int(value)}%")

# 导出全库（带进度显示）
export_all_to_excel(
    db, 
    Path("output.xlsx"),
    progress_callback=show_progress
)

print("导出完成！")
```

## 🧪 性能测试

运行性能测试脚本：

```bash
python test_export_performance.py
```

测试内容：
- ✅ 数据库统计信息
- ✅ 全库 Excel 导出速度
- ✅ 全库 CSV 导出速度
- ✅ 单患者导出速度

示例输出：

```
============================================================
数据库统计信息
============================================================
Patient             :    500 条记录
Surgery             :    450 条记录
Pathology           :    480 条记录
Molecular           :    320 条记录
FollowUpEvent       :    890 条记录
------------------------------------------------------------
总计                :   2640 条记录
============================================================

测试：全库 Excel 导出
------------------------------------------------------------
  进度: 10%
  进度: 20%
  ...
  进度: 100%
✓ 导出成功
  耗时: 4.23 秒
  文件大小: 1.85 MB
  平均速度: 118.2 患者/秒
```

## 💡 性能对比

| 患者数 | v3.5.4 | v3.6.0 | 提升 |
|-------|--------|--------|------|
| 100   | 2.5秒  | 1.2秒  | 2.1x |
| 500   | 12秒   | 4秒    | 3.0x |
| 1000  | 28秒   | 8秒    | 3.5x |

## ⚙️ 高级配置

### 调整线程数

编辑 `export/parallel.py` 文件：

```python
# 默认配置（推荐）
max_workers = min(4, len(tables))

# 高性能配置（8核以上 CPU）
max_workers = min(8, len(tables))

# 自动配置（根据 CPU 核心数）
import os
max_workers = min(os.cpu_count(), len(tables))
```

### 适用场景

| 场景 | 推荐线程数 |
|------|-----------|
| 小数据量 (<100患者) | 2-4 |
| 中等数据量 (100-1000) | 4-6 |
| 大数据量 (>1000) | 6-8 |
| SSD 硬盘 | 6-8 |
| HDD 硬盘 | 2-4 |

## 🎨 界面预览

### 进度窗口

```
┌────────────────────────────────────┐
│         导出进度                    │
├────────────────────────────────────┤
│  正在导出数据，请稍候...            │
│                                    │
│  ████████████████░░░░░░░░░░  65%  │
│                                    │
└────────────────────────────────────┘
```

### 导出标签页提示

```
┌────────────────────────────────────┐
│  提示：导出使用多线程加速，         │
│  大数据量时可显著提升性能           │
├────────────────────────────────────┤
│  [ 导出当前患者 (Excel) ]           │
│  [ 导出当前患者 (CSV)   ]           │
│  [ 导出全库 (Excel)     ]           │
│  [ 导出全库 (CSV)       ]           │
└────────────────────────────────────┘
```

## ❓ 常见问题

### Q1: 为什么我的导出没有变快？

**A:** 可能的原因：
- 数据量太小（<50患者），线程开销大于收益
- 数据库在网络驱动器上，I/O 是瓶颈
- CPU 核心数较少（单核或双核）

**解决**：
- 小数据量时多线程优势不明显
- 将数据库移到本地 SSD
- 减少线程数到 2

### Q2: 导出时程序无响应？

**A:** v3.6.0 已修复此问题！
- 导出现在在后台线程执行
- UI 界面保持响应
- 可以继续使用其他功能

### Q3: 如何查看详细的导出日志？

**A:** 查看控制台输出或日志文件：

```bash
python main.py > output.log 2>&1
```

### Q4: 支持哪些导出格式？

**A:** 目前支持：
- ✅ Excel (.xlsx) - 单文件多工作表
- ✅ CSV (.csv) - 多文件（每表一个文件）
- 🔜 PDF（计划中）
- 🔜 JSON（计划中）

## 📚 更多信息

- **详细文档**：[EXPORT_OPTIMIZATION.md](EXPORT_OPTIMIZATION.md)
- **完整更新日志**：[CHANGELOG_v3.6.0.md](CHANGELOG_v3.6.0.md)
- **项目主页**：[README.md](README.md)

## 🐛 问题反馈

遇到问题？欢迎反馈：

- **GitHub Issues**: https://github.com/xenorexq/Thoracic-Database/issues
- **邮箱**: qinzhi100@gmail.com

## 🎉 享受更快的导出体验！

v3.6.0 让大数据量导出不再是痛苦的等待，而是快速、流畅的体验！

---

**提示**：首次运行可能需要缓存预热，第二次会更快！

