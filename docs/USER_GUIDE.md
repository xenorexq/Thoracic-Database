# 用户指南

## 快速开始

### 安装与运行

#### Windows用户（推荐）
1. 下载最新版本的`thoracic_entry.exe`
2. 双击运行即可，无需安装Python环境
3. 数据库文件`thoracic.db`会自动在程序所在目录创建

#### 开发者/源码运行
```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 运行程序
python main.py
```

---

## 核心功能

### 1. 患者管理

#### 新建患者
1. 点击"患者/治疗"标签页
2. 填写患者基本信息（住院号、癌种、性别等）
3. 点击"保存患者"按钮

#### 搜索患者
- 在搜索框中输入住院号或患者信息
- 支持模糊搜索
- 可按癌种筛选

#### 编辑患者
1. 从列表中选择患者
2. 修改信息
3. 点击"保存患者"更新

#### 删除患者
- 选择患者后点击"删除患者"
- 需要两次确认
- 会级联删除所有相关记录（手术、病理、分子、随访）

---

### 2. 手术记录

#### 添加手术记录
1. 选择患者
2. 切换到"手术记录"区域
3. 填写手术信息
4. 点击"保存记录"

#### 多条手术记录
- 每个患者可以有多条手术记录
- 列表显示格式：`住院号-日期-序号`
- 点击列表项可查看详情

---

### 3. 病理记录

#### 添加病理记录
1. 选择患者
2. 切换到"病理记录"区域
3. 填写病理信息（标本类型、组织学类型、TNM分期等）
4. 点击"保存记录"

#### TRG评分
- 支持0-5级评分
- 适用于新辅助治疗后的病理评估

---

### 4. 分子检测

#### 添加分子检测记录
1. 选择患者
2. 切换到"分子检测"区域
3. 选择检测平台（PCR/NGS/CTC/METHYLATION）
4. 填写基因、变异等信息
5. 点击"保存记录"

#### 平台特定字段
- **PCR/NGS**: 基因、变异、PD-L1、TMB/MSI
- **CTC**: CTC计数
- **METHYLATION**: 甲基化结果

---

### 5. 随访管理

#### 添加随访事件
1. 选择患者
2. 切换到"随访"标签页
3. 点击"新建事件"
4. 选择事件类型（生存/复发/转移/失访/死亡）
5. 填写日期和详情
6. 点击"保存事件"

#### 事件类型说明
- **生存**: 定期随访，患者状态良好
- **复发**: 肿瘤复发，需填写复发部位
- **转移**: 肿瘤转移，需填写转移部位
- **失访**: 失去联系
- **死亡**: 患者死亡

---

### 6. 数据导入

#### 导入其他数据库
1. 点击"文件" -> "导入数据库..."
2. 选择要导入的`.db`文件
3. 系统会自动检查：
   - 新患者数量
   - 重复患者（已存在的不会重复导入）
   - 数据完整性
4. 确认后点击"✓ 确认导入"按钮
5. 等待导入完成

#### 导入注意事项
- 支持导入v3.0及以上版本的数据库
- 重复的住院号会被自动跳过
- 导入过程中请勿关闭程序
- 导入完成后会自动刷新患者列表

---

### 7. 数据导出

#### 导出当前患者
1. 选择要导出的患者
2. 点击"查询/导出"标签页
3. 选择导出格式：
   - **Excel**: 单个文件，多个工作表
   - **CSV**: 多个文件，每个表一个文件
4. 选择保存位置
5. 等待导出完成

#### 导出全库
1. 点击"导出全库 Excel"或"导出全库 CSV"
2. 选择保存位置
3. 等待导出完成（大数据库可能需要几分钟）

#### 导出内容
- **Patient**: 患者基本信息
- **Surgery**: 手术记录
- **Pathology**: 病理记录
- **Molecular**: 分子检测记录
- **FollowUpEvent**: 随访事件

---

### 8. 数据库管理

#### 备份数据库
1. 点击"工具" -> "备份数据库"
2. 选择备份位置
3. 备份文件命名格式：`thoracic_backup_YYYYMMDD_HHMMSS.db`

#### 健康检查
1. 点击"工具" -> "数据库健康检查"
2. 查看检查报告
3. 如有问题，点击"快速修复"

---

## 高级功能

### AJCC分期参考

在"患者/治疗"页面，点击右侧的"Lung"或"Eso"按钮可查看：
- 肺癌AJCC第9版分期表
- 食管癌AJCC第9版分期表

### 数据验证

系统会自动验证：
- 住院号唯一性
- 日期格式正确性
- 数值范围合理性
- 外键完整性

---

## 常见问题

### Q: 导入时提示"event_code错误"怎么办？
A: 这是旧版本数据库的兼容性问题。v3.7.2已修复，请升级到最新版本。

### Q: 导出的Excel文件打不开？
A: 确保：
1. 文件路径不包含特殊字符
2. 有足够的磁盘空间
3. Excel版本支持.xlsx格式

### Q: 如何恢复误删的数据？
A: 
1. 如果有备份，使用"导入数据库"功能恢复
2. 如果没有备份，数据无法恢复（建议定期备份）

### Q: 程序运行缓慢怎么办？
A: 
1. 检查数据库大小（>100MB可能较慢）
2. 运行"数据库健康检查"
3. 关闭其他占用资源的程序

### Q: 打包成EXE后找不到数据库？
A: v3.7.2已修复此问题。数据库会自动创建在EXE所在目录。

---

## 数据安全建议

1. **定期备份**: 建议每周备份一次数据库
2. **多地存储**: 将备份文件保存到不同位置（U盘、云盘等）
3. **版本控制**: 保留多个历史备份版本
4. **测试恢复**: 定期测试备份文件能否正常恢复

---

## 技术支持

- **GitHub**: [项目地址]
- **Email**: qinzhi100@gmail.com
- **文档**: 查看项目中的其他Markdown文档

---

*最后更新: 2025-11-25*
*版本: v3.7.2*

