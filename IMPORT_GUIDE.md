# 数据库导入功能使用指南

## 问题说明

之前的导入功能界面不够清晰，用户选择数据库文件后看到预检查结果，但不清楚如何继续导入。

## 改进内容 (v3.7.1)

已对导入预览对话框进行了重大改进，使操作流程更加清晰明了：

### 1. 更清晰的标题和说明
- **主标题**：📊 数据库导入预检查完成
- **副标题**：显示检测到的新患者数量
- **操作提示**：明确告诉用户"请确认下方信息后，点击底部的'确认导入'按钮开始导入"

### 2. 更醒目的导入按钮
- 使用绿色主题按钮（bootstyle="success"）
- 按钮文字包含新患者数量：`✓ 确认导入 (X 位新患者)`
- 在按钮上方添加醒目提示：`👉 点击下方按钮开始导入数据：`

### 3. 更好的无数据提示
- 当没有新患者可导入时，显示清晰的提示信息
- 提示文字：`ℹ 所有患者均已存在于当前数据库中，无需导入`

## 使用流程

### 步骤 1：选择要导入的数据库文件
1. 打开应用程序
2. 点击菜单 `文件` → `导入数据库...`
3. 在文件选择对话框中，选择一个或多个要导入的 `.db` 文件
4. 点击 `打开`

### 步骤 2：查看预检查结果
系统会弹出"数据库导入 - 确认导入"对话框，显示：

#### 预检查摘要
- 源文件数量
- 总患者数
- 新患者数（可导入）
- 本地重复（将跳过）
- 源间重复（将使用第一次出现的）

#### 关联数据预估
- 预计导入的手术记录数
- 预计导入的病理记录数
- 预计导入的分子记录数
- 预计导入的随访事件数

#### 详细报告
- 滚动文本框显示完整的分析报告
- 包括重复患者的详细列表
- 可通过"导出报告"按钮保存为文本文件

### 步骤 3：确认导入

**情况 A：有新患者可导入**
1. 查看预检查结果，确认数据无误
2. 看到底部的提示：`👉 点击下方按钮开始导入数据：`
3. 点击绿色的 `✓ 确认导入 (X 位新患者)` 按钮
4. 系统开始导入数据，显示进度条
5. 导入完成后显示成功消息

**情况 B：没有新患者**
- 对话框会显示：`ℹ 所有患者均已存在于当前数据库中，无需导入`
- 点击 `关闭` 按钮退出

### 步骤 4：查看导入结果
导入完成后，系统会显示导入统计：
```
已成功导入：

Patient: X 条
Surgery: X 条
Pathology: X 条
Molecular: X 条
FollowUpEvent: X 条

请刷新患者列表。
```

## 重要提示

### ✓ 数据安全
- 导入操作**不会覆盖**现有数据
- 重复的患者（相同住院号）会自动跳过
- 建议在导入前先备份数据库（`文件` → `备份数据库...`）

### ✓ 导入规则
- 患者唯一性：按 `hospital_id`（住院号）判断
- 关联数据：新患者的所有关联数据（手术、病理、分子、随访）会一起导入
- 多文件导入：可同时选择多个数据库文件，系统会合并导入

### ✓ 常见问题

**Q: 为什么选择文件后没有立即导入？**
A: 这是正常的！系统会先进行预检查，然后显示确认对话框。你需要在对话框中点击"确认导入"按钮才会开始实际导入。

**Q: 预检查对话框在哪里确认导入？**
A: 在对话框的**底部**，有一个绿色的"✓ 确认导入"按钮。如果你没看到，可能是：
   1. 窗口被遮挡，试着调整窗口大小或位置
   2. 没有新患者可导入（所有患者都已存在）

**Q: 导入时间会很长吗？**
A: 导入速度取决于数据量。系统会显示进度条，并在后台线程中执行，不会卡顿界面。

**Q: 可以取消导入吗？**
A: 可以在预检查阶段点击"✗ 取消"按钮。但一旦点击"确认导入"，为了保证数据完整性，建议让导入过程完成。

## 版本信息

- **改进版本**：v3.7.1
- **改进日期**：2025-11-25
- **改进文件**：`ui/import_preview_dialog.py`

## 相关文档

- [数据库合并安全指南](docs/DATABASE_MERGE_SAFETY.md)
- [ID冲突常见问题](docs/ID_CONFLICT_FAQ.md)
- [备份指南](BACKUP_GUIDE.md)

